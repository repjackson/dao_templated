template(name='tasks')
    .ui.stackable.grid
        .row
            .four.wide.column
                .ui.header 
                    i.tasks.icon
                    |#{tasks.count}
                    |tasks
                .ui.icon.large.button.new_task
                    i.green.plus.icon
                +task_cloud
                with currentUser
                    .ui.list
                        .item(title='hours today')
                            i.sun.icon
                            i.clock.icon
                            | #{daily_hours}hrs
                        .item(title='weekly hours')
                            i.calendar.icon
                            i.clock.icon
                            | #{weekly_hours}hrs
                        .item(title='sessions today')
                            i.sun.icon
                            i.business.time.icon
                            | #{daily_sessions} sessions
                        .item(title='weekly sessions')
                            i.calendar.icon
                            i.business.time.icon
                            | #{weekly_sessions} sessions
            .six.wide.column
                //- with top_task
                //-     +task_card_template
                i.link.refresh.icon.refresh_my_time_stats
                .ui.small.compact.icon.button.toggle_complete(title='view complete' class=view_complete_class)
                    i.checkmark.icon
                //- .ui.small.compact.icon.button.toggle_incomplete(title='incomplete') 
                //-     i.circle.outline.icon
                |sort by 
                .ui.small.compact.button lucrative
                .ui.small.compact.button soonest
                .ui.small.compact.button priority
            
                .largescroll.ui.segments
                    each tasks 
                        +task_card_template
            .six.wide.column
                if picked_task_doc
                    .ui.icon.right.floated.button.unselect_task
                        i.remove.icon
                    with picked_task_doc
                        +picked_task
                else 
                    // .ui.icon.basic.button.new_task 
                    //     i.plus.icon
                    //     // |new task 
                    i.refresh.link.icon.refresh_tasks_stats
                    with tasks_stats_doc
                        .ui.small.grey.header #{total_tasks} total tasks 
                        .ui.small.grey.header #{week_tasks_count} tasks this week
                        .ui.small.grey.header #{day_tasks_count} tasks today
                    
                    
                    

template(name='task_cloud')
    //- #task_cloud
        //- .ui.left.icon.input
        //-     i.search.icon
        //-     +inputAutocomplete settings=settings id="search" class="" autocomplete="off" 
        // .ui.hidden.fitted.divider
    i.grey.tags.icon
    if picked_tags
        #clear_tags.ui.active.icon.compact.button
            i.remove.icon
        each picked_tags
            .unselect_tag.ui.active.compact.button
                strong #{this}
    each all_tags
        .ui.compact.small.button.select_tag(class=task_cloud_tag_class) 
            strong #{this.name}




template(name='task_card_template')
    .ui.segment.pointer.select_task(class=task_segment_class)
        .ui.header.goto_task #{title}
        div
        .ui.horizontal.list 
            .item(title='views')
                i.eye.icon 
                |#{views}
            .item(title='points')
                i.thumbs.up.outline.icon
                |#{points}
            if task_list_id 
                .item(title='task list')
                    i.list.icon 
                    |#{task_list.title}
            .item
                i.grey.tags.icon 
                each five_tags
                    .ui.small.label #{this}
        div
        if weight 
            .ui.small.inline.header #{weight} weight
        if assigned_by
            .ui.large.label(title='assigned by')
                |#{assigned_by}
            .ui.small.inline.header ->
        if assigned_to
            .ui.large.label(title='assigned to')
                |#{assigned_to}
        unless complete
            if percent_complete
                .rounded(style="height:5px;width:{{percent_complete}}%;background-color:grey" title="{{percent_complete}}% complete")
                    //- 
                    //- .ui.bottom.attached.progress(data-percent="{{percent_complete}}" title="{{percent_complete}}% complete")
                    //-     .bar
                        //- .progress
                    //- .label complete
    // .spacer



template(name='picked_task')
    if editing_task 
        +text_edit key='title' direct=true
        +array_edit key='tags' direct=true
        div
        .ui.icon.large.button.save_task(title='save task') 
            i.checkmark.green.large.icon
        .ui.icon.small.button.delete_task(title='delete task') 
            i.remove.icon
    else 
        .ui.small.header #{title}
        +array_view key='tags' direct=true
        div
        .ui.icon.large.button.edit_task(title='edit task') 
            i.pencil.blue.icon
        .ui.icon.large.button.goto_task(title='view task') 
            i.right.chevron.large.icon
        div
        +voting_full


template(name='subscriptions')
    .ui.inline.grey.header 
        i.newspaper.small.icon
        |subscriptions
    if subscribed 
        .ui.icon.button.unsubscribe(title='unsubscribe')
            i.bell.slash.outline.icon
    else 
        .ui.icon.button.subscribe(title='subscribe')
            i.bell.outline.icon
    .ui.list
        each subscribers
            .item #{username}



template(name='task_view')
    with current_doc
        .ui.stackable.grid
            .row 
                .five.wide.column
                    .ui.large.button.goto_tasks
                        i.left.chevron.icon
                        |tasks
                    if parent_dependents
                        .ui.small.header parent dependents
                        each parent_dependents
                            a.ui.button(href="/task/#{_id}/view")
                                i.left.chevron.icon
                                |#{title}
                    
                    a.ui.icon.button(href="/task/#{_id}/edit" title='edit') 
                        i.pencil.grey.icon
                    //- +multi_user_edit key='subscriber_ids' label='subscriptions' direct=true
                    div
                    +subscriptions
                    div
                    +author_info
                    +creation_info
                    div
                    .ui.grey.inline.header 
                        i.clock.small.icon
                        |time tracking
                    .ui.compact.icon.button.new_task
                        i.plus.icon
                    .ui.link.list
                        each tasks 
                            a.item(href="/task/#{_id}/view")
                                |{{long_time start_datetime}}-{{long_time end_datetime}}
                                small by #{_author_username}
                    .ui.small.grey.header total time #{total_time}
                    div
                    +viewing
                    div
                    +voting_full
                .seven.wide.column
                    if parent_id
                        a.ui.fluid.button(href="/task/#{parent_id}/view")
                            i.up.chevron.icon
                            |#{parent_doc.title}
                    
                    .ui.header #{title}
                    | !{description}
                    div
                    +comments
                    .ui.grey.inline.header 
                        i.small.fork.icon
                        |sub tasks 
                    i.plus.link.icon.new_subtask
                    div
                    each subtasks 
                        .ui.segment
                            +text_edit key='title' direct=true
                            +text_edit key='assigned_to' direct=true
                            a.ui.icon.button(href="/task/#{_id}/view")
                                i.right.chevron.icon
                            +remove_button
                .four.wide.column
                    if child_dependents
                        .ui.small.header child dependents
                        each child_dependents
                            a.ui.fluid.small.button(href="/task/#{_id}/view")
                                i.right.chevron.icon
                                |#{title}
                    if group_id
                        .ui.header
                            i.list.icon 
                            |group 
                        with group 
                            |#{title}
                    div
                    .ui.inline.small.grey.header 
                        i.small.grey.sign.in.inline.icon 
                        |assigned to
                    .ui.inline.header #{assigned_to}
                    div
                    .ui.small.inline.grey.header 
                        i.small.grey.sign.out.inline.icon 
                        | assigned by
                    .ui.inline.header #{assigned_by}
                    if due_date
                        div
                        .ui.small.grey.inline.header
                            i.small.grey.calendar.inline.icon 
                            | due date
                        .ui.inline.header #{due_date}
                        div
                        .ui.small.grey.inline.header due
                        .ui.inline.header 
                            |{{from_now due_date}}
                    div
                    if due_time
                        .ui.inline.small.grey.header  due time
                        .ui.inline.header #{due_time}
                    if complete 
                        .ui.large.green.label 
                            |complete
                        .ui.icon.button.mark_incomplete(title='mark incomplete')
                            i.remove.icon
                    else 
                        .ui.large.label 
                            |incomplete
                        .ui.icon.button.mark_complete(title='mark complete')
                            i.checkmark.icon
                    .ui.grey.header 
                        i.small.inline.rss.icon
                        |activity 
                    .ui.feed
                        each log_events
                            .event
                                .content
                                    .summary
                                        |#{text}
                                    .meta
                                        |#{when} 
                                        if is_admin 
                                            +remove_icon
                    if percent_complete
                        .ui.disabled.indicating.progress(data-percent="{{percent_complete}}" title="{{percent_complete}}% complete")
                            .bar
                                .progress
                            .label complete
                        .ui.hidden.divider
                    if weight
                        .ui.disabled.indicating.progress(data-percent="{{weight}}" title="{{weight}} weight")
                            .bar
                                .progress
                            .label weight



template(name='task_edit')
    with current_doc
        .ui.stackable.grid
            .row 
                .four.wide.column
                    a.ui.fluid.large.button(href="/task/#{_id}/view") 
                        i.checkmark.icon
                        |save
                    +remove_button
                    +boolean_edit key='approval_required' label='approval required' direct=true
                    if approval_required 
                        +text_edit key='approving_username' label='approving username' direct=true
                    +boolean_edit key='bounty' label='bounty' direct=true
                    if bounty 
                        +number_edit key='bounty_amount' label='bounty amount' direct=true
                    +number_edit key='estimated_hours' label='estimated hours' direct=true
                    +number_edit key='actual_hours' label='actual hours' direct=true
                
                .eight.wide.column
                    +text_edit key='title' label='title' direct=true
                    +html_edit key='description' label='description' direct=true
                    div 
                    +array_edit key='tags' label='tags' direct=true
                .four.wide.column
                    +text_edit key='parent_id' label='parent id' direct=true
                    //- if task_list_id 
                    //-     with task_list
                    //-         .ui.segment
                    //-             i.grey.list.icon
                    //-             a.ui.inline.header(href="/task_list/#{_id}/view" title='view task list') #{title}
                    //-             i.small.link.grey.remove.icon.clear_task_list(title='remove from list')
                    //- +task_list_lookup key='task_list_id' label='task list' direct=true
                    //- if task_list_id 
                    //-     with task_list
                    //-         .ui.segment
                    //-             i.grey.list.icon
                    //-             a.ui.inline.header(href="/task_list/#{_id}/view" title='view task list') #{title}
                    //-             i.small.link.grey.remove.icon.clear_task_list(title='remove from list')
                    +single_user_edit key='assigned_by' label='assigned by' direct=true
                    if assigned_by
                        +text_view key='assigned_by' direct=true
                    +single_user_edit key='assigned_to' label='assigned to' icon='sign out' direct=true
                    if assigned_to
                        +text_view key='assigned_to' icon='sign in' direct=true
                    +date_edit key='due_date' label='due date' icon='calendar' direct=true
                    +boolean_edit key='complete' label='complete' icon='checkmark' direct=true
                    +number_edit key='percent_complete' label='percent complete' icon='percent' min=0 max=100 direct=true
                    +number_edit key='weight' label='weight' icon='sort up' min=0 max=100 direct=true
