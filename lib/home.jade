template(name='home')
    .ui.padded.stackable.grid
        .sixteen.wide.column
            .ui.inline.header 
                i.pizza.slice.icon
                |backcountry
                // i.chat.outline.large.icon(title='backcountry chat')
            .ui.basic.icon.button.add_post
                i.large.plus.icon
            if post_tag_results
                .ui.inline.small.header
                    i.tag.icon
                    |tags
                each picked_post_tags
                    a.ui.blue.label.unpick_post_tag
                        |#{this}
                each post_tag_results
                    if title
                        a.ui.basic.large.small.link.label.pick_post_tag
                            |#{title} 
                            small.ui.grey.text #{count}
                
            .ui.large.icon.input(title='messages cost one point but can receive points from votes')
                i.plus.icon
                input.new_message(type='text' placeholder='quick add (-1p)')
            if session_is 'view_images' true
                .ui.inline.header color picker
            if session_is 'view_locations' true
                .ui.inline.header near me
            
            // .four.wide.column
            .ui.big.label(title='results')
                |#{home_items.count}
            // span.sorting_row
            +search_input model='post' field='title'
            // .ui.small.inline.header 
            //     |layout
            +session_set key='view_layout' value='grid' icon='th' 
            +session_set key='view_layout' value='list' icon='list'
            // .ui.small.inline.header 
            //     |direction
            +session_set key='sort_direction' value='-1' icon='chevron down'
            +session_set key='sort_direction' value='1' icon='chevron up'
            // .ui.small.inline.header 
            //     |by
            +session_set key='sort_key' value='points' label='points' icon='coins'
            +session_set key='sort_key' value='created_date' label='when' icon='clock'
            // +session_set key='view_limit' value=1
            
            i.large.sort.icon
            .ui.compact.icon.button.set_sort_direction(title='toggle sort direction')
                if sorting_up
                    i.sort.amount.down.icon
                else
                    i.sort.amount.up.icon
            |&nbsp;
            |&nbsp;
            // .ui.compact.menu
            //     .ui.simple.dropdown.item
            //         strong #{product_limit}
            //         i.dropdown.icon
            //         .menu
            //           +set_product_limit amount=1
            //           +set_product_limit amount=5
            //           +set_product_limit amount=10
            //             +set_product_limit amount=20
            // div
            // .ui.small.inline.header 
            //     |media
            +session_set key='view_videos' value=true label='when' icon='youtube'
            +session_set key='view_images' value=true label='view images' icon='image'
            +session_set key='view_events' value=true label='view events' icon='calendar'
            +session_set key='view_tasks' value=true label='view tasks' icon='checkmark'
            +session_set key='view_locations' value=true label='view location' icon='marker'
            +session_set key='view_food' value='view_food' label='view' icon='food'
            // .ui.inline.header
            // .ui.circular.button
            //     // |p                
            //     i.chevron.up.large.icon
            // .ui.circular.button
            //     // |p                
            //     i.chevron.large.down.icon
            // .ui.inline.header
            //     i.line.chart.icon
            //     |leaderboard
            each top_users
                .ui.inline.header #{username}
            .ui.inline.header 
                |your points
                |#{currentUser.points}
            if current_post
                .ui.stackable.grid
                    .six.wide.column.scrolling
                        each home_items
                            +home_item
                            // .ui.divider
                    .ten.wide.column.scrolling
                        with current_post
                            +post_view
                            // .ui.header
                            //     |#{title}
            else 
                .ui.stackable.padded.five.column.grid.scrolling
                    each home_items
                        .column
                            +home_item
                    

template(name='home_item')
    // if session_is 'editing_chat' _id
    //     .ui.item
    //         .content
    //             +text_edit key='title' direct=true
    //             i.checkmark.large.link.green.icon.save_chat   
    //             +boolean_edit key='archived' label='archived' icon='archive' direct=true
    // else
    .ui.segment.zoomer.pointer(class=card_class)
        if image_id
            +image_view key='image_id' direct=true
        if youtube_id
            +youtube_view key='image_id' direct=true
        // if is_selected
        //     .ui.header this one
        // if unless
        // else
        //     img.ui.image(src="{{c.url image_id width=500 height=500 gravity='face' crop='fill'}}")
        .content.view_post_quick
            // a.ui.header.zoomer.fly_right(href="/post/#{_id}") !{title}
            a.ui.header.zoomer.view_post_quick !{title}
            
            a.author    
                if _author_username
                    a(href="/user/#{_author_username}")
                        |#{_author_username}
                else 
                    // i.anon.grey.icon
                    |anonymous
                    
                .metadata
                    |#{when}
                    small {{long_date _timestamp}}
            .text.view_post_quick
                |!{body}
            span.meta
                if is_task
                    i.big.checkmark.icon
                if is_event
                    i.big.calendar.icon
                a.fly_right(href="/post/#{_id}")
                    i.eye.link.icon
                    |#{views}
                +voting_small
                if in_dev
                    +print_this
                    +alert_this
                // if is_admin
                //     i.pencil.large.link.icon.edit_chat            
                if can_edit
                    a.zoomer.fly_down(href="/post/#{_id}/edit")
                        i.pencil.large.link.icon
                if watson
                    +doc_emotion_small
            unless viewing_full
                .ui.icon.circular.basic.button.view_full
                    i.chevron.down.icon
                    // |view full
            if viewing_full
                .ui.icon.circular.basic.button.view_less
                    i.chevron.up.icon
                    // |view less
