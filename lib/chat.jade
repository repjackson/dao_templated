template(name='chats')
    .ui.padded.stackable.grid
        .twelve.wide.column
            .ui.inline.header 
                |#{chat_docs.count}
                |Backcountry Pizza
                // i.chat.outline.large.icon(title='backcountry chat')
            .ui.basic.icon.button.add_post
                i.large.plus.icon
            if post_tag_results
                .ui.inline.small.header
                    i.tag.icon
                    |tags
                each picked_post_tags
                    a.ui.blue.label.unpick_post_tag
                        |#{this}
                each post_tag_results
                    if title
                        a.ui.basic.large.small.link.label.pick_post_tag
                            |#{title} 
                            small.ui.grey.text #{count}
                
            .ui.large.icon.input(title='messages cost one point but can receive points from votes')
                i.plus.icon
                input.new_message(type='text' placeholder='quick add (-1p)')
            .ui.comments.scrolling
                each chat_docs
                    +chat_message
        .four.wide.column
            span.sorting_row
                +search_input model='post' field='title'
                .ui.small.inline.header 
                    |layout
                +session_set key='view_users' value='grid' icon='th' 
                +session_set key='view_users' value='list' icon='list'
                .ui.small.inline.header 
                    |direction
                +session_set key='sort_users_direction' value='-1' icon='chevron down'
                +session_set key='sort_users_direction' value='1' icon='chevron up'
                .ui.small.inline.header 
                    |by
                +session_set key='sort_users_key' value='points' label='points' icon='coins'
                +session_set key='sort_users_key' value='created_date' label='when' icon='clock'
                // +session_set key='view_limit' value=1
                
                i.large.sort.icon
                .ui.compact.icon.button.set_sort_direction(title='toggle sort direction')
                    if sorting_up
                        i.sort.amount.down.icon
                    else
                        i.sort.amount.up.icon
                |&nbsp;
                |&nbsp;
                // .ui.compact.menu
                //     .ui.simple.dropdown.item
                //         strong #{product_limit}
                //         i.dropdown.icon
                //         .menu
                //           +set_product_limit amount=1
                //           +set_product_limit amount=5
                //           +set_product_limit amount=10
                //             +set_product_limit amount=20
                div
                .ui.small.inline.header 
                    |media
                .ui.icon.button
                    i.youtube.icon
                    |video
                .ui.compact.button
                    i.image.icon
                    |image
                .ui.compact.button
                    i.calendar.icon
                    |event
                .ui.compact.button
                    i.money.icon
                    |price
                .ui.compact.button
                    i.checkmark.icon
                    |task
            .ui.header points given
            .ui.header points received
            .ui.header
                i.line.chart.icon
                |leaderboard
            each top_users
                .ui.header #{username}
            .ui.header 
                |your points
                |#{currentUser.points}
                


template(name='chat_message')
    // if session_is 'editing_chat' _id
    //     .ui.item
    //         +image_edit key='image_id' direct=true
    //         .content
    //             +text_edit key='title' direct=true
    //             i.checkmark.large.link.green.icon.save_chat   
    //             +boolean_edit key='archived' label='archived' icon='archive' direct=true
    // else
    .comment
        // if unless
        // else
        //     img.ui.image(src="{{c.url image_id width=500 height=500 gravity='face' crop='fill'}}")
        .content
            a.ui.header.zoomer.fly_right(href="/post/#{_id}") !{title}
            
            a.author    
                if _author_username
                    a(href="/user/#{_author_username}")
                        |#{_author_username}
                else 
                    // i.anon.grey.icon
                    |anonymous
                    
                .metadata
                    |#{when}
                    small {{long_date _timestamp}}
            .text 
                |!{body}
            span.meta
                a.fly_right(href="/post/#{_id}")
                    i.eye.link.icon
                    |#{views}
                +voting_small
                if in_dev
                    +print_this
                    +alert_this
                // if is_admin
                //     i.pencil.large.link.icon.edit_chat            
                if can_edit
                    a.zoomer.fly_down(href="/post/#{_id}/edit")
                        i.pencil.large.link.icon
                if watson
                    +doc_emotion_small
            unless viewing_full
                .ui.button.view_full
                    i.chevron.down.icon
                    |view full
            if viewing_full
                .ui.button.view_less
                    i.chevron.up.icon
                    |view less
