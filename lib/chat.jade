template(name='chats')
    .ui.padded.stackable.grid
        .sixteen.wide.column
            .ui.inline.header 
                |#{chat_docs.count}
                i.chat.outline.large.icon(title='backcountry chat')
            .ui.basic.icon.button.add_post
                i.large.plus.icon
            if post_tag_results
                .ui.inline.small.header
                    i.tag.icon
                    |tags
                each picked_post_tags
                    a.ui.blue.label.unpick_post_tag
                        |#{this}
                each post_tag_results
                    if title
                        a.ui.basic.circular.small.link.label.pick_post_tag
                            |#{title} 
                            small.ui.grey.text #{count}
                
            .ui.large.icon.input(title='messages cost one point but can receive points from votes')
                i.plus.icon
                input.new_message(type='text' placeholder='quick add (-1p)')
            span.sorting_row
                +search_input model='post' field='title'
                +session_set key='view_users' value='grid' icon='th' 
                +session_set key='view_users' value='list' icon='list'
                +session_set key='sort_users_direction' value='-1' icon='chevron down'
                +session_set key='sort_users_direction' value='1' icon='chevron up'
                +session_set key='sort_users_key' value='points' icon='coins'
                +session_set key='sort_users_key' value='created_date' icon='clock'
                +session_set key='view_limit' value=1
                
                i.large.sort.icon
                .ui.compact.icon.button.set_sort_direction(title='toggle sort direction')
                    if sorting_up
                        i.sort.amount.down.icon
                    else
                        i.sort.amount.up.icon
                |&nbsp;
                |&nbsp;
                .ui.compact.menu
                    .ui.simple.dropdown.item
                        strong #{product_limit}
                        i.dropdown.icon
                        .menu
                          +set_product_limit amount=1
                          +set_product_limit amount=5
                          +set_product_limit amount=10
                            +set_product_limit amount=20
                .spacer 
        
                
            .ui.comments
                each chat_docs
                    +chat_message


template(name='chat_message')
    // if session_is 'editing_chat' _id
    //     .ui.item
    //         +image_edit key='image_id' direct=true
    //         .content
    //             +text_edit key='title' direct=true
    //             i.checkmark.circular.link.green.icon.save_chat   
    //             +boolean_edit key='archived' label='archived' icon='archive' direct=true
    // else
    .comment
        // if unless
        // else
        //     img.ui.image(src="{{c.url image_id width=500 height=500 gravity='face' crop='fill'}}")
        .content
            a.ui.header.zoomer.fly_right(href="/post/#{_id}") !{body}
            .meta
                if _author_username
                    a(href="/user/#{_author_username}")
                        | by 
                        |#{_author_username}
                    span
                        |#{when}
                        small {{long_date _timestamp}}
                else 
                    // i.anon.grey.icon
                    |by anonymous
                a(href="/post/#{_id}")
                    i.eye.circular.link.icon
                    |#{views}
                +voting_small
                if in_dev
                    +print_this
                    +alert_this
                // if is_admin
                //     i.pencil.circular.link.icon.edit_chat            
                if can_edit
                    a.zoomer(href="/post/#{_id}/edit")
                        i.pencil.circular.link.icon
